---
  -hosts: servers
  sudo: yes
  become_user: ubuntu
  tasks:
    - name: Install Nginx
      apt:
       name: nginx
       state: latest

    - name: Instal PHP-FPM
      apt:
       name: ['php','php-fpm','php-common','php-cli','php-curl']
       state: latest
    
    - name: Configure php.ini
      blockinfile:
        dest: /etc/php/5.3/fpm/php.ini
        block: |
         date.time = Asia/Kolkata
         cgi-fix_pathinfo = 0
      backup: yes
      notify: restart php-fpm

    - name: Create Nginx virtual host
      template:
      src: vhost.j2
      dest: /etc/nginx/sites-enabled/vhost-surendra.ga
      notify: restart nginx

    - name: Create web-root directory
      file:
      path: /var/www/surendra.ga
      state: directory

    - name: Upload index.html and info.php files
      template:
      src: index.php.j2
      dest: /var/www/surendra.ga/index.php 


    - name: restart nginx
      service:
        name: nginx
      state: restarted
      enabled: yes

    - name: restart php-fpm
      service:
       name: php5.3-fpm
      state: restarted
      enabled: yes      
